<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Course Support Widget</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Core brand & surface */
:root{
--brand: #ffffff;
--bg: #f8f9fa;
--panel: rgba(255, 255, 255, 0.95);
--panel-2: rgba(240, 248, 255, 0.9);
--text: #1a365d; /* Darker blue for better contrast in light mode */
--muted: #6c757d;
--line: rgba(51, 102, 204, 0.2);
--accent: #4d94ff;
--accent-light: #e6f0ff;
/* Bubbles */
--user: #3366cc;
--bot: rgba(255, 255, 255, 0.95);
/* Effects */
--shadow-1: 0 4px 12px rgba(51, 102, 204, 0.15);
--shadow-2: 0 8px 24px rgba(51, 102, 204, 0.1);
--radius-xl: 18px;
--radius-lg: 14px;
--radius-md: 12px;
--radius-sm: 8px;
/* Gradients */
--grad-brand: linear-gradient(135deg, #e6f0ff 0%, #f0f7ff 100%);
--grad-fab: linear-gradient(135deg, #4d94ff 0%, #3366cc 100%);
--grad-header: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);
--grad-enrollment: linear-gradient(135deg, #4d94ff 0%, #3366cc 100%);
}
/* Widget-specific dark theme */
#chatWidget[data-theme="dark"] {
--bg: #1a1f2e;
--panel: rgba(30, 40, 60, 0.95);
--panel-2: rgba(40, 50, 70, 0.9);
--text: #ffffff; /* White text for better contrast in dark mode */
--muted: #b8c5d6; /* Lighter muted text for dark mode */
--line: rgba(255, 255, 255, 0.15);
--accent: #5b9dff;
--accent-light: rgba(91, 157, 255, 0.15);
--bot: rgba(40, 50, 70, 0.95);
--shadow-1: 0 4px 12px rgba(0, 0, 0, 0.3);
--shadow-2: 0 8px 24px rgba(0, 0, 0, 0.4);
--grad-brand: linear-gradient(135deg, #2a3f5f 0%, #1e283c 100%);
--grad-fab: linear-gradient(135deg, #5b9dff 0%, #3366cc 100%);
--grad-header: linear-gradient(135deg, #2a3f5f 0%, #1e283c 100%);
--grad-enrollment: linear-gradient(135deg, #5b9dff 0%, #3366cc 100%);
}
/* Global styles */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f8f9fa;
  color: #333;
  transition: none;
}
/* ================= Floating Button ================= */
#chatBtn{
position: fixed; inset: auto 20px 20px auto;
width: 56px; height: 56px; border-radius: 50%;
border: none; cursor: pointer; z-index: 1000; margin-right: 60px;
background: var(--grad-fab); color: #ffffff;
box-shadow: var(--shadow-2);
display:grid; place-items:center; font-size:24px;
transform: translateZ(0);
transition: all 0.3s ease;
}
#chatBtn:hover{ filter:brightness(1.1); transform: translateY(-3px) scale(1.05); }
#chatBtn:active{ transform: translateY(0) scale(0.98); }
/* ================= Widget Shell ================= */
#chatWidget{
position: fixed; right: 82px; bottom: 80px; width: 380px; max-width: calc(100vw - 24px);
height: 520px; max-height: calc(100vh - 120px);
background: var(--panel);
border: 1px solid var(--line);
border-radius: var(--radius-xl);
box-shadow: var(--shadow-2);
overflow: hidden; display:none; flex-direction: column; z-index: 1001;
backdrop-filter: blur(8px);
animation: slideUp .35s ease both;
transition: all 0.3s ease;
}
#chatWidget.expanded {
  width: 480px;
  height: 620px;
}
@keyframes slideUp{
from{ opacity:0; transform: translateY(10px) scale(.98); }
to{ opacity:1; transform: translateY(0) scale(1); }
}
/* ================= Header ================= */
#chatHeader{
position: relative;
background: var(--grad-header);
color: var(--text); padding: 16px 16px 14px 16px;
display:flex; align-items:center; gap:12px; justify-content:space-between;
border-bottom: 1px solid var(--line);
}
.header-left{ display:flex; gap:12px; align-items:center; }
.brand-dot{
width:38px; height:38px; border-radius:12px; background: var(--accent-light);
display:grid; place-items:center; backdrop-filter: blur(2px);
}
.brand-dot i{ font-size:14px; color: var(--accent); }
.title-wrap{ line-height: 1.2; }
.title-wrap .h{
font-weight:700; font-size:15px; letter-spacing:.3px;
color: var(--text);
}
.title-wrap .s{
font-size:12px; opacity:.8;
color: var(--muted);
}
.header-actions{
display:flex; gap:8px; align-items:center;
}
.icon-btn{
background: var(--panel-2);
color: var(--text); border:1px solid var(--line);
width:36px; height:36px; border-radius:10px;
display:grid; place-items:center; cursor:pointer;
transition:.2s ease;
}
.icon-btn:hover{ background: var(--accent-light); transform: translateY(-1px); }
.icon-btn:active{ transform: none; }
.tabs{
position:absolute; left:16px; right:16px; bottom:-50px;
display:flex; gap:8px; padding:6px; border-radius:12px;
background: var(--panel-2);
border:1px solid var(--line);
backdrop-filter: blur(6px);
box-shadow: var(--shadow-1);
}
.tab-btn{
flex:1; font-size:12px; padding:8px 10px; border-radius:10px;
color: var(--text); text-align:center; cursor:pointer; user-select:none; opacity:.85;
transition: all 0.2s ease;
}
.tab-btn.active{ background: var(--accent-light); font-weight:700; opacity:1; color: var(--accent); }
.tab-btn:hover { opacity: 1; }
/* ================= Topics Menu ================= */
.topics-menu {
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 5px;
  width: 220px;
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-2);
  padding: 8px;
  z-index: 1003;
  display: none;
}
.topics-menu.show {
  display: block;
}
.topics-menu-item {
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 13px;
  color: var(--text);
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}
.topics-menu-item:hover {
  background: var(--accent-light);
}
.topics-menu-divider {
  height: 1px;
  background: var(--line);
  margin: 6px 0;
}
/* ================= Body ================= */
#chatBody{
margin-top: 60px; /* space for tabs overlap */
flex:1; padding: 12px 12px 12px 12px; overflow:auto; background: transparent;
transition: margin-top 0.3s ease;
}
#chatBody.no-tabs {
  margin-top: 0;
}
/* Message bubble */
.msg{ margin:12px 0; display:flex; flex-direction:column; gap:6px; }
.message-bubble{
max-width: 86%; padding: 12px 16px; margin-top: 8px; border-radius: 18px;
border:1px solid var(--line); background: var(--bot);
box-shadow: var(--shadow-1);
color: var(--text);
font-size: 14px;
line-height: 1.4;
}
.bot .message-bubble{ align-self:flex-start; }
.user .message-bubble{ align-self:flex-end; background: var(--user); color:#ffffff; border:none; }
.message-time{
font-size: 11px; color: var(--muted);
}
.user .message-time{ align-self:flex-end; }
.bot .message-time{ align-self:flex-start; }
/* Typing */
.typing{
display:inline-flex; gap:6px; padding:10px 14px; border-radius:16px;
border:1px dashed var(--line); background: var(--panel-2);
align-self:flex-start; box-shadow: var(--shadow-1);
}
.dot{ width:8px; height:8px; border-radius:50%; background: var(--accent); animation: bl 1.2s infinite; }
.dot:nth-child(2){ animation-delay:.15s; }
.dot:nth-child(3){ animation-delay:.3s; }
@keyframes bl{ 0%,80%,100%{opacity:.25} 40%{opacity:1} }
.chat-sticker{ max-width: 180px; border-radius: 12px; margin-top:6px; }
/* ================= Input Area ================= */
#chatInputArea{
display:flex; gap:8px; padding:12px; border-top: 1px solid var(--line);
background: var(--panel);
}
#chatInputWrapper {
  flex:1;
  position: relative;
}
#chatInput{
width: 85%; padding: 12px 16px; border-radius: 18px; outline:none;
border:1px solid var(--line); background: var(--panel-2); color: var(--text);
transition: .18s ease; font-size:14px;
}
#chatInput:focus{ border-color: var(--accent); box-shadow: 0 0 0 4px rgba(77, 148, 255, 0.18); }
#chatInput:disabled {
  cursor: not-allowed;
  opacity: 0.7;
}
#sendBtn{
border:none; border-radius: 18px; padding: 0 18px; cursor:pointer;
background: var(--grad-fab); color:#ffffff; font-weight:600;
display:grid; place-items:center; box-shadow: var(--shadow-1);
min-width: 44px;
}
#sendBtn:hover{ filter:brightness(1.05); }
#sendBtn:disabled {
  cursor: not-allowed;
  opacity: 0.7;
}
/* Enhanced Input Area */
.input-actions {
  display: flex;
  gap: 6px;
  align-items: center;
}
.action-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: var(--panel-2);
  color: var(--text);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}
.action-btn:hover {
  background: var(--accent-light);
  transform: translateY(-1px);
}
/* Emoji Picker */
.emoji-picker {
  position: absolute;
  bottom: 70px;
  right: 20px;
  width: 280px;
  height: 200px;
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-2);
  padding: 10px;
  display: none;
  overflow-y: auto;
  z-index: 1002;
}
.emoji-picker.show {
  display: block;
}
.emoji-category {
  margin-bottom: 10px;
}
.emoji-category-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--muted);
  margin-bottom: 5px;
}
.emoji-list {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
}
.emoji-item {
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s;
}
.emoji-item:hover {
  background: var(--accent-light);
  transform: scale(1.2);
}
/* File Upload */
.file-upload {
  position: absolute;
  bottom: 70px;
  right: 20px;
  width: 280px;
  background: var(--panel);
  border: 1px solid var(--line);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-2);
  padding: 15px;
  display: none;
  z-index: 1002;
}
.file-upload.show {
  display: block;
}
.file-upload-area {
  border: 2px dashed var(--line);
  border-radius: var(--radius-md);
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
}
.file-upload-area:hover {
  border-color: var(--accent);
  background: var(--accent-light);
}
.file-upload-area i {
  font-size: 24px;
  color: var(--accent);
  margin-bottom: 10px;
}
.file-upload-area p {
  margin: 0;
  font-size: 14px;
  color: var(--text);
}
.file-upload input[type="file"] {
  display: none;
}
.file-list {
  margin-top: 10px;
}
.file-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px;
  background: var(--panel-2);
  border-radius: var(--radius-sm);
  margin-bottom: 5px;
}
.file-name {
  font-size: 13px;
  color: var(--text);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 180px;
}
.file-remove {
  color: var(--muted);
  cursor: pointer;
  transition: color 0.2s;
}
.file-remove:hover {
  color: #ff5252;
}
/* Quick Replies */
.quick-replies {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 8px 12px;
  background: var(--panel);
  border-top: 1px solid var(--line);
}
.quick-reply {
  padding: 6px 12px;
  border-radius: 16px;
  background: var(--panel-2);
  border: 1px solid var(--line);
  color: var(--text);
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
}
.quick-reply:hover {
  background: var(--accent-light);
  transform: translateY(-1px);
}
/* ================= FAQ view (clean & compact) ================= */
.faq-wrap{ display:flex; flex-direction:column; gap:6px; }
.faq-search{
display:flex; gap:6px; align-items:center; padding:10px 12px;
border:1px solid var(--line); border-radius: var(--radius-md); background: var(--bot);
position:sticky;
}
.faq-search input{
flex:1; border:none; background:transparent; outline:none; color:var(--text);
font-size:14px;
}
.faq-category{
border:1px solid var(--line); background: rgb(120, 178, 197); border-radius: var(--radius-md);
padding: 12px 14px; font-size: 14px; display:flex; justify-content:space-between; align-items:center;
cursor:pointer; transition: .18s ease;
}
.faq-category:hover{ transform: translateY(-1px); box-shadow: var(--shadow-1); }
.faq-category .left{ display:flex; gap:10px; align-items:center; }
.faq-category small{ color: var(--muted); font-weight:500; }
.faq-accordion{ padding: 8px 8px 2px 8px; display:none; }
.faq-accordion.open{ display:block; }
.faq-question{
background: var(--panel-2); border:1px dashed var(--line); border-radius: var(--radius-sm);
padding:10px 12px; font-size: 13px; margin:6px 0; cursor:pointer;
transition:.16s ease;
}
.faq-question:hover{ background: var(--accent-light); transform: translateY(-1px); }
/* ================= Contact Form Styles ================= */
.contact-form {
  padding: 15px;
  background: var(--bot);
  border-radius: var(--radius-lg);
  margin: 10px;
  border: 1px solid var(--line);
}
.form-group {
  margin-bottom: 12px;
}
.form-group label {
  display: block;
  margin-bottom: 4px;
  font-size: 13px;
  color: var(--text);
  font-weight: 600;
}
.form-control {
  width: 100%;
  padding: 8px 10px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--line);
  background: var(--panel-2);
  color: var(--text);
  font-size: 13px;
  transition: all 0.2s;
}
.form-control:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(77, 148, 255, 0.2);
}
.form-control select {
  cursor: pointer;
}
.form-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}
.btn {
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 13px;
  transition: all 0.2s;
  flex: 1;
}
.btn-primary {
  background: var(--grad-fab);
  color: #ffffff;
}
.btn-primary:hover {
  filter: brightness(1.05);
  transform: translateY(-1px);
}
.btn-secondary {
  background: var(--panel);
  color: var(--text);
  border: 1px solid var(--line);
}
.btn-secondary:hover {
  background: var(--panel-2);
}
.success-message {
  padding: 12px;
  background: rgba(72, 187, 120, 0.2);
  border: 1px solid rgba(72, 187, 120, 0.5);
  border-radius: var(--radius-md);
  color: #2f855a;
  text-align: center;
  margin: 10px;
  display: none;
  font-size: 13px;
}
/* ================= Course Cards ================= */
.course-cards {
  display: flex;
  flex-direction: column;
  gap: 14px;
  padding: 12px;
}
.course-card {
  background: var(--bot);
  border-radius: var(--radius-md);
  padding: 14px;
  border: 1px solid var(--line);
  transition: all 0.2s;
}
.course-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-1);
}
.course-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}
.course-title {
  font-weight: 600;
  font-size: 15px;
  color: var(--text);
}
.course-duration {
  font-size: 12px;
  color: var(--muted);
  background: var(--panel-2);
  padding: 3px 8px;
  border-radius: 20px;
}
.course-description {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 10px;
}
.course-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.course-price {
  font-weight: 600;
  color: var(--accent);
}
/* Demo Button */
.demo-btn {
  padding: 6px 12px;
  border-radius: 16px;
  background: var(--grad-fab);
  color: #ffffff;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  border: none;
  display: flex;
  align-items: center;
  gap: 4px;
}
.demo-btn:hover {
  filter: brightness(1.1);
  transform: translateY(-1px);
}
/* Modern Date/Time Picker */
.datetime-picker-modern {
  margin-top: 12px;
  border-radius: var(--radius-md);
  background: var(--panel-2);
  border: 1px solid var(--line);
  padding: 15px;
  box-shadow: var(--shadow-1);
  width: 100%;
  max-width: 320px;
  box-sizing: border-box;
}
.datetime-picker-modern h5 {
  margin: 0 0 12px 0;
  font-size: 14px;
  color: var(--text);
  text-align: center;
  font-weight: 600;
}
.datetime-row {
  display: flex;
  gap: 10px;
  margin-bottom: 12px;
}
.datetime-input-group {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.datetime-input-label {
  font-size: 11px;
  color: var(--muted);
  display: flex;
  align-items: center;
  gap: 4px;
}
.datetime-input-field {
  width: 100%;
  padding: 8px 10px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--line);
  background: var(--panel);
  color: var(--text);
  font-size: 13px;
  transition: all 0.2s;
  box-sizing: border-box;
}
.datetime-input-field:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(77, 148, 255, 0.2);
}
.datetime-schedule-btn {
  width: 100%;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  border: none;
  background: var(--grad-fab);
  color: #ffffff;
  font-weight: 600;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
  box-sizing: border-box;
}
.datetime-schedule-btn:hover {
  filter: brightness(1.05);
}
/* ================= Welcome Form ================= */
.welcome-form-container {
  padding: 15px;
  background: var(--panel-2);
  border-radius: var(--radius-lg);
  border: 1px solid var(--line);
  margin: 0px;
  box-shadow: var(--shadow-1);
}
.welcome-form-container h4 {
  margin: 0 0 15px 0;
  color: white;
  font-size: 16px;
  text-align: center;
  padding: 10px;
  border-radius: var(--radius-md);
  background: var(--grad-enrollment);
  box-shadow: var(--shadow-1);
  letter-spacing: 0.5px;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.welcome-form-container p {
  margin: 0 0 15px 0;
  color: var(--muted);
  font-size: 13px;
  text-align: center;
}
/* ================= Mobile ================= */
@media (max-width: 600px){
#chatWidget{ right: 0; bottom: 0; width: 100%; height: 100%; max-height: 100%; border-radius: 0; }
#chatBtn{ right: 18px; bottom: 18px; }
}
</style>
</head>
<body>
<!-- Floating Button -->
<button id="chatBtn" aria-label="Open course support" title="Course Support">
<i class="bi bi-mortarboard"></i>
</button>
<!-- Chat Widget -->
<div id="chatWidget" aria-live="polite">
<div id="chatHeader">
<div class="header-left">
<div class="brand-dot"><i class="bi bi-mortarboard"></i></div>
<div class="title-wrap">
<div class="h">Course Support</div>
<div class="s">Enrollment ‚Ä¢ Academic Help</div>
</div>
</div>
<div class="header-actions">
<button class="icon-btn" id="clearChatBtn" title="Clear chat" aria-label="Clear chat"><i class="bi bi-trash"></i></button>
<button class="icon-btn" id="themeToggleBtn" title="Toggle theme" aria-label="Toggle theme"><i class="bi bi-moon-stars"></i></button>
<button class="icon-btn" id="expandWidgetBtn" title="Expand widget" aria-label="Expand widget"><i class="bi bi-arrows-angle-expand"></i></button>
<button class="icon-btn" id="topicsMenuBtn" title="Topics menu" aria-label="Topics menu"><i class="bi bi-list-ul"></i></button>
<button class="icon-btn" id="closeWidgetBtn" title="Minimize" aria-label="Minimize"><i class="bi bi-dash-lg"></i></button>
<!-- Topics Menu -->
<div class="topics-menu" id="topicsMenu">
  <div class="topics-menu-item" data-value="chat">
    <i class="bi bi-chat-dots"></i> Chat Panel
  </div>
  <div class="topics-menu-item" data-value="courses">
    <i class="bi bi-book"></i> Courses Panel
  </div>
  <div class="topics-menu-item" data-value="faq">
    <i class="bi bi-question-circle"></i> FAQ Panel
  </div>
  <div class="topics-menu-divider"></div>
  <div class="topics-menu-item" data-value="Courses">
    <i class="bi bi-book"></i> Courses (Topic)
  </div>
  <div class="topics-menu-item" data-value="Fees">
    <i class="bi bi-currency-dollar"></i> Fees & Scholarships
  </div>
  <div class="topics-menu-item" data-value="Schedule">
    <i class="bi bi-calendar3"></i> Schedule
  </div>
  <div class="topics-menu-item" data-value="Certificates">
    <i class="bi bi-award"></i> Certificates
  </div>
  <div class="topics-menu-item" data-value="Instructors">
    <i class="bi bi-person-badge"></i> Instructors
  </div>
  <div class="topics-menu-item" data-value="Contact">
    <i class="bi bi-telephone"></i> Contact Us
  </div>
  <div class="topics-menu-item" data-value="Technical">
    <i class="bi bi-gear"></i> Technical Support
  </div>
  <div class="topics-menu-item" data-value="Resources">
    <i class="bi bi-tools"></i> Resources
  </div>
</div>
</div>
<div class="tabs" id="tabsContainer">
<div class="tab-btn active" data-tab="chat">üí¨ Chat</div>
<div class="tab-btn" data-tab="courses">üìö Courses</div>
<div class="tab-btn" data-tab="faq">üìñ FAQ</div>
</div>
</div>
<div id="chatBody"></div>
<div class="quick-replies" id="quickReplies">
  <div class="quick-reply" data-message="Tell me about your courses">Tell me about your courses</div>
  <div class="quick-reply" data-message="How do I enroll?">How do I enroll?</div>
  <div class="quick-reply" data-message="What are the fees?">What are the fees?</div>
  <div class="quick-reply" data-message="Do you offer certificates?">Do you offer certificates?</div>
</div>
<div id="chatInputArea">
<div id="chatInputWrapper">
  <input type="text" id="chatInput" placeholder="Type a message..." />
</div>
<div class="input-actions">
  <button class="action-btn" id="emojiBtn" title="Add emoji"><i class="far fa-smile"></i></button>
  <button class="action-btn" id="attachBtn" title="Attach file"><i class="fas fa-paperclip"></i></button>
</div>
<button id="sendBtn" title="Send">‚û§</button>
</div>
<!-- Emoji Picker -->
<div class="emoji-picker" id="emojiPicker">
  <div class="emoji-category">
    <div class="emoji-category-title">Smileys</div>
    <div class="emoji-list">
      <div class="emoji-item">üòÄ</div>
      <div class="emoji-item">üòÉ</div>
      <div class="emoji-item">üòÑ</div>
      <div class="emoji-item">üòÅ</div>
      <div class="emoji-item">üòÖ</div>
      <div class="emoji-item">üòÇ</div>
      <div class="emoji-item">ü§£</div>
      <div class="emoji-item">üòä</div>
      <div class="emoji-item">üòá</div>
      <div class="emoji-item">üôÇ</div>
      <div class="emoji-item">üòâ</div>
      <div class="emoji-item">üòå</div>
      <div class="emoji-item">üòç</div>
      <div class="emoji-item">ü•∞</div>
      <div class="emoji-item">üòò</div>
      <div class="emoji-item">üòó</div>
      <div class="emoji-item">üòô</div>
      <div class="emoji-item">üòö</div>
      <div class="emoji-item">üòã</div>
      <div class="emoji-item">üòõ</div>
    </div>
  </div>
  <div class="emoji-category">
    <div class="emoji-category-title">Gestures</div>
    <div class="emoji-list">
      <div class="emoji-item">üëç</div>
      <div class="emoji-item">üëé</div>
      <div class="emoji-item">üëå</div>
      <div class="emoji-item">‚úåÔ∏è</div>
      <div class="emoji-item">ü§û</div>
      <div class="emoji-item">ü§ü</div>
      <div class="emoji-item">ü§ò</div>
      <div class="emoji-item">ü§ô</div>
      <div class="emoji-item">üëà</div>
      <div class="emoji-item">üëâ</div>
      <div class="emoji-item">üëÜ</div>
      <div class="emoji-item">üëá</div>
      <div class="emoji-item">‚òùÔ∏è</div>
      <div class="emoji-item">‚úã</div>
      <div class="emoji-item">ü§ö</div>
      <div class="emoji-item">üñêÔ∏è</div>
      <div class="emoji-item">üññ</div>
      <div class="emoji-item">üëã</div>
      <div class="emoji-item">ü§è</div>
      <div class="emoji-item">üí™</div>
    </div>
  </div>
  <div class="emoji-category">
    <div class="emoji-category-title">Education</div>
    <div class="emoji-list">
      <div class="emoji-item">üéì</div>
      <div class="emoji-item">üìö</div>
      <div class="emoji-item">üìñ</div>
      <div class="emoji-item">üìù</div>
      <div class="emoji-item">üîç</div>
      <div class="emoji-item">üí°</div>
      <div class="emoji-item">üß†</div>
      <div class="emoji-item">üè´</div>
      <div class="emoji-item">üèõÔ∏è</div>
      <div class="emoji-item">üìê</div>
      <div class="emoji-item">üìè</div>
      <div class="emoji-item">üßÆ</div>
      <div class="emoji-item">üìä</div>
      <div class="emoji-item">üìà</div>
      <div class="emoji-item">üìâ</div>
      <div class="emoji-item">üóÇÔ∏è</div>
      <div class="emoji-item">üìÅ</div>
      <div class="emoji-item">üìÇ</div>
      <div class="emoji-item">üóÉÔ∏è</div>
      <div class="emoji-item">üóÑÔ∏è</div>
    </div>
  </div>
</div>
<!-- File Upload -->
<div class="file-upload" id="fileUpload">
  <div class="file-upload-area" id="fileUploadArea">
    <i class="fas fa-cloud-upload-alt"></i>
    <p>Drag & drop files here or click to browse</p>
    <input type="file" id="fileInput" multiple>
  </div>
  <div class="file-list" id="fileList"></div>
</div>
</div>
<script>
/* ========= DOM refs ========= */
const chatBtn = document.getElementById('chatBtn');
const chatWidget = document.getElementById('chatWidget');
const closeWidgetBtn = document.getElementById('closeWidgetBtn');
const themeToggleBtn = document.getElementById('themeToggleBtn');
const clearChatBtn = document.getElementById('clearChatBtn');
const expandWidgetBtn = document.getElementById('expandWidgetBtn');
const topicsMenuBtn = document.getElementById('topicsMenuBtn');
const topicsMenu = document.getElementById('topicsMenu');
const chatBody = document.getElementById('chatBody');
const chatInput = document.getElementById('chatInput');
const chatInputWrapper = document.getElementById('chatInputWrapper');
const sendBtn = document.getElementById('sendBtn');
const tabButtons = document.querySelectorAll('.tab-btn');
const tabsContainer = document.getElementById('tabsContainer');
const quickReplies = document.getElementById('quickReplies');
const emojiBtn = document.getElementById('emojiBtn');
const emojiPicker = document.getElementById('emojiPicker');
const attachBtn = document.getElementById('attachBtn');
const fileUpload = document.getElementById('fileUpload');
const fileUploadArea = document.getElementById('fileUploadArea');
const fileInput = document.getElementById('fileInput');
const fileList = document.getElementById('fileList');
const chatInputArea = document.getElementById('chatInputArea');
/* ========= LocalStorage helpers ========= */
const LS = {
open: 'course_v3_open',
history: 'course_v3_history',
theme: 'course_v3_theme',
view: 'course_v3_view',
expanded: 'course_v3_expanded',
formSubmitted: 'course_v3_form_submitted',
sessionStart: 'course_v3_session_start'
};
const safeParse = (raw, fallback) => {
if (!raw) return fallback;
try {
const parsed = JSON.parse(raw);
return Array.isArray(parsed) ? parsed : fallback;
} catch (e) {
console.warn('LocalStorage parse failed, resetting key:', e);
return fallback;
}
};
/* ========= Session Management ========= */
// Check if this is a new session (page load)
const isNewSession = !localStorage.getItem(LS.sessionStart) || 
                    (Date.now() - parseInt(localStorage.getItem(LS.sessionStart)) > 300000); // 5 minutes
if (isNewSession) {
  // Reset form submission state for new session
  localStorage.setItem(LS.formSubmitted, 'false');
  localStorage.setItem(LS.sessionStart, Date.now().toString());
}
/* ========= Theme autodetect & set ========= */
const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
const savedTheme = localStorage.getItem(LS.theme);
const currentTheme = savedTheme ? savedTheme : (prefersDark ? 'dark' : 'light');
/* ========= Sounds ========= */
let sendSound, receiveSound;
try {
  sendSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3');
  receiveSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3');
} catch (e) {
  console.warn('Audio files could not be loaded:', e);
  // Create dummy audio objects to prevent errors
  sendSound = { play: () => {} };
  receiveSound = { play: () => {} };
}
/* ========= Course Data ========= */
const courseData = [
  {
    id: 'full-stack-python',
    title: 'Full Stack Python',
    duration: '16 weeks',
    price: '$399',
    description: 'Master front-end & back-end development with Python, Django, and React to build dynamic web applications. Get hands-on training, real-time projects, and 100% placement assistance from the best software training institute in Coimbatore!'
  },
  {
    id: 'full-stack-java',
    title: 'Full Stack Java',
    duration: '16 weeks',
    price: '$399',
    description: 'Learn to build powerful web applications using Java, Spring Boot, and Angular with hands-on coding and real-time projects. Get expert training, industry-recognized certification, and 100% placement support from the best software training institute in Coimbatore!'
  },
  {
    id: 'full-time-full-stack-python',
    title: 'Full Time Full Stack Python',
    duration: '20 weeks',
    price: '$499',
    description: 'Become a job-ready Full Stack Python Developer with in-depth training in Python, Django, React, and databases. Gain real-time project experience, career mentoring, and 100% placement support from the best software training institute in Coimbatore!'
  },
  {
    id: 'full-stack-mern',
    title: 'Full Stack Developer ‚Äì MERN',
    duration: '14 weeks',
    price: '$349',
    description: 'Master MongoDB, Express.js, React, and Node.js to build scalable web applications from scratch. Get hands-on experience with live projects and industry-recognized certification to launch your career as a MERN Stack Developer!'
  },
  {
    id: 'digital-marketing',
    title: 'Digital Marketing',
    duration: '8 weeks',
    price: '$199',
    description: 'Learn SEO, Google Ads, Social Media Marketing, and more with practical case studies. This industry-focused digital marketing course prepares you for high-demand marketing roles with placement assistance!'
  },
  {
    id: 'digital-marketing-job-assured',
    title: 'Digital Marketing Job Assured',
    duration: '12 weeks',
    price: '$299',
    description: 'Unlock guaranteed job opportunities with our specialized job-assured digital marketing program, featuring real-world projects, certification, and placement support. Get trained by industry experts and land your dream job!'
  },
  {
    id: 'selenium-testing',
    title: 'Selenium Testing With Java',
    duration: '10 weeks',
    price: '$249',
    description: 'Master automation testing with Selenium and Java to become an expert QA Engineer. Get hands-on training and placement assistance with leading IT companies!'
  },
  {
    id: 'data-science-python',
    title: 'Data Science With Python',
    duration: '16 weeks',
    price: '$399',
    description: 'Learn machine learning, AI, and data analytics using Python with real-world projects. Become a certified data scientist with expert training and 100% job support in top companies!'
  },
  {
    id: 'full-stack-php',
    title: 'Full Stack PHP',
    duration: '12 weeks',
    price: '$299',
    description: 'Build dynamic websites and web applications using PHP, Laravel, and MySQL. Get expert-led training, real-time project experience, and placement assistance to kickstart your career in web development!'
  },
  {
    id: 'mobile-app-android',
    title: 'Mobile App Development Android',
    duration: '14 weeks',
    price: '$349',
    description: 'Master Android app development with Java and build high-performing mobile applications. Get hands-on training, live projects, and placement support in leading app development firms!'
  },
  {
    id: 'wordpress-course',
    title: 'WordPress Course',
    duration: '6 weeks',
    price: '$149',
    description: 'Learn to create stunning websites with WordPress, WP Bakery‚Äì no coding required! Gain practical experience, freelancing skills, and placement support from industry experts!'
  },
  {
    id: 'hr-course',
    title: 'HR Course',
    duration: '8 weeks',
    price: '$199',
    description: 'HR professional with in-depth training on recruitment, and HR policies. Get real-world case studies, certification, and career guidance to land HR roles in top companies!'
  },
  {
    id: 'student-career-club',
    title: 'Student Career Club',
    duration: 'Ongoing',
    price: '$99',
    description: 'Join our exclusive career club to network with industry experts, attend career workshops, and get job-ready. Get access to internships, mentorship, and career growth opportunities in IT and non-IT fields!'
  }
];
/* ========= Chat state ========= */
let currentView = localStorage.getItem(LS.view) || 'chat';
let chatHistory = safeParse(localStorage.getItem(LS.history), []);
let chatOpen = localStorage.getItem(LS.open) === 'true';
let widgetExpanded = localStorage.getItem(LS.expanded) === 'true';
let formSubmitted = localStorage.getItem(LS.formSubmitted) === 'true';
let attachedFiles = [];
let isSubmitting = false; // Flag to prevent multiple form submissions
let currentDemoCourse = null; // To store the course for which demo is requested
/* ========= Init ========= */
function initChat() {
// Apply theme to widget only
chatWidget.setAttribute('data-theme', currentTheme);
themeToggleBtn.innerHTML = currentTheme === 'dark' ? '<i class="bi bi-brightness-high"></i>' : '<i class="bi bi-moon-stars"></i>';
// open state
chatWidget.style.display = chatOpen ? 'flex' : 'none';
// expanded state
if (widgetExpanded) {
  chatWidget.classList.add('expanded');
  expandWidgetBtn.innerHTML = '<i class="bi bi-arrows-angle-contract"></i>';
}
// Hide tabs and quick replies if form not submitted
if (!formSubmitted) {
  tabsContainer.style.display = 'none';
  quickReplies.style.display = 'none';
  chatInputArea.style.display = 'none';
  chatBody.classList.add('no-tabs');
}
// render initial view based on form submission status
if (!formSubmitted) {
  renderWelcomeForm();
} else if (currentView === 'faq') {
  renderFAQ();
} else if (currentView === 'courses') {
  renderCourses();
} else {
  renderChatFromHistory();
  if (chatHistory.length === 0) {
    setTimeout(()=> botReply("Hello! üëã Welcome to Course Support! How can I assist you today?"), 400);
  }
}
// Set the state of input, send button, and quick replies based on formSubmitted
if (formSubmitted) {
  document.getElementById('chatInput').disabled = false;
  document.getElementById('sendBtn').disabled = false;
  document.querySelectorAll('.quick-reply').forEach(reply => {
    reply.style.pointerEvents = 'auto';
    reply.style.opacity = '1';
  });
} else {
  document.getElementById('chatInput').disabled = true;
  document.getElementById('sendBtn').disabled = true;
  document.querySelectorAll('.quick-reply').forEach(reply => {
    reply.style.pointerEvents = 'none';
    reply.style.opacity = '0.5';
  });
}
// listeners
chatBtn.addEventListener('click', toggleChat);
closeWidgetBtn.addEventListener('click', toggleChat);
sendBtn.addEventListener('click', sendMessage);
chatInput.addEventListener('keypress', e => { if (e.key === 'Enter') sendMessage(); });
clearChatBtn.addEventListener('click', clearChatSafe);
themeToggleBtn.addEventListener('click', toggleTheme);
expandWidgetBtn.addEventListener('click', toggleWidgetSize);
tabButtons.forEach(btn => btn.addEventListener('click', ()=> switchTab(btn.dataset.tab)));
// Add click event listener to chat input wrapper
chatInputWrapper.addEventListener('click', function(e) {
  if (!formSubmitted) {
    alert('Please enroll first before you can send a message.');
    e.preventDefault();
    e.stopPropagation();
  }
});
// Topics menu
topicsMenuBtn.addEventListener('click', function(e) {
  if (!formSubmitted) {
    alert('Please enroll first before you can access topics menu.');
    e.preventDefault();
    e.stopPropagation();
    return;
  }
  e.stopPropagation();
  topicsMenu.classList.toggle('show');
  emojiPicker.classList.remove('show');
  fileUpload.classList.remove('show');
});
document.addEventListener('click', function(e) {
  if (!topicsMenuBtn.contains(e.target) && !topicsMenu.contains(e.target)) {
    topicsMenu.classList.remove('show');
  }
});
topicsMenu.addEventListener('click', function(e) {
  if (e.target.classList.contains('topics-menu-item')) {
    if (!formSubmitted) {
      alert('Please enroll first before you can send a message.');
      botReply("Please complete the enrollment form first to chat with us.");
      return;
    }
    
    const value = e.target.getAttribute('data-value');
    topicsMenu.classList.remove('show');
    
    // Check if it's a panel selection
    if (value === 'chat' || value === 'courses' || value === 'faq') {
      switchTab(value);
    } else {
      // It's a topic selection
      const question = value;
      addMessage(question, 'user');
      handleUserMessage(question);
    }
  }
});
// Quick replies
quickReplies.addEventListener('click', function(e) {
  if (e.target.classList.contains('quick-reply')) {
    if (!formSubmitted) {
      alert('Please enroll first before you can send a message.');
      botReply("Please complete the enrollment form first to chat with us.");
      return;
    }
    const message = e.target.getAttribute('data-message');
    addMessage(message, 'user');
    handleUserMessage(message);
  }
});
// Emoji picker
emojiBtn.addEventListener('click', function() {
  if (!formSubmitted) {
    alert('Please enroll first before you can use emojis.');
    return;
  }
  emojiPicker.classList.toggle('show');
  fileUpload.classList.remove('show');
  topicsMenu.classList.remove('show');
});
document.addEventListener('click', function(e) {
  if (!emojiBtn.contains(e.target) && !emojiPicker.contains(e.target)) {
    emojiPicker.classList.remove('show');
  }
});
emojiPicker.addEventListener('click', function(e) {
  if (e.target.classList.contains('emoji-item')) {
    const emoji = e.target.textContent;
    chatInput.value += emoji;
    chatInput.focus();
  }
});
// File upload
attachBtn.addEventListener('click', function() {
  if (!formSubmitted) {
    alert('Please enroll first before you can attach files.');
    return;
  }
  fileUpload.classList.toggle('show');
  emojiPicker.classList.remove('show');
  topicsMenu.classList.remove('show');
});
document.addEventListener('click', function(e) {
  if (!attachBtn.contains(e.target) && !fileUpload.contains(e.target)) {
    fileUpload.classList.remove('show');
  }
});
fileUploadArea.addEventListener('click', function() {
  fileInput.click();
});
fileInput.addEventListener('change', function() {
  handleFiles(this.files);
});
// Drag and drop
['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
  fileUploadArea.addEventListener(eventName, preventDefaults, false);
});
function preventDefaults(e) {
  e.preventDefault();
  e.stopPropagation();
}
['dragenter', 'dragover'].forEach(eventName => {
  fileUploadArea.addEventListener(eventName, highlight, false);
});
['dragleave', 'drop'].forEach(eventName => {
  fileUploadArea.addEventListener(eventName, unhighlight, false);
});
function highlight() {
  fileUploadArea.style.borderColor = 'var(--accent)';
  fileUploadArea.style.backgroundColor = 'var(--accent-light)';
}
function unhighlight() {
  fileUploadArea.style.borderColor = 'var(--line)';
  fileUploadArea.style.backgroundColor = 'transparent';
}
fileUploadArea.addEventListener('drop', function(e) {
  handleFiles(e.dataTransfer.files);
});
}
function toggleChat(){
chatOpen = !chatOpen;
chatWidget.style.display = chatOpen ? 'flex' : 'none';
localStorage.setItem(LS.open, chatOpen);
}
function toggleWidgetSize() {
  widgetExpanded = !widgetExpanded;
  chatWidget.classList.toggle('expanded');
  localStorage.setItem(LS.expanded, widgetExpanded);
  
  if (widgetExpanded) {
    expandWidgetBtn.innerHTML = '<i class="bi bi-arrows-angle-contract"></i>';
  } else {
    expandWidgetBtn.innerHTML = '<i class="bi bi-arrows-angle-expand"></i>';
  }
}
function switchTab(tab){
  if (!formSubmitted && tab !== 'chat') {
    alert('Please enroll first before you can access other features.');
    botReply("Please complete the enrollment form first to access other features.");
    return;
  }
  
  currentView = tab;
  localStorage.setItem(LS.view, tab);
  tabButtons.forEach(b => b.classList.toggle('active', b.dataset.tab === tab));
  if (tab === 'faq') renderFAQ(); 
  else if (tab === 'courses') renderCourses();
  else renderChatFromHistory();
}
function renderChatFromHistory(){
chatBody.innerHTML = '';
chatHistory.forEach(m => addMessage(m.text, m.sender, false, m.time));
}
/* ========= Welcome Form ========= */
function renderWelcomeForm() {
  chatBody.innerHTML = '';
  
  const formContainer = document.createElement('div');
  formContainer.className = 'welcome-form-container';
  
  const title = document.createElement('h4');
  title.textContent = 'Welcome to Course Support!';
  
  const description = document.createElement('p');
  description.textContent = 'Please complete this quick form to get started with our course support services.';
  
  const form = document.createElement('form');
  form.id = 'welcomeForm';
  
  // Name field
  const nameGroup = document.createElement('div');
  nameGroup.className = 'form-group';
  const nameLabel = document.createElement('label');
  nameLabel.textContent = 'Full Name';
  nameLabel.setAttribute('for', 'welcomeName');
  const nameInput = document.createElement('input');
  nameInput.type = 'text';
  nameInput.id = 'welcomeName';
  nameInput.className = 'form-control';
  nameInput.required = true;
  nameGroup.appendChild(nameLabel);
  nameGroup.appendChild(nameInput);
  form.appendChild(nameGroup);
  
  // Email field
  const emailGroup = document.createElement('div');
  emailGroup.className = 'form-group';
  const emailLabel = document.createElement('label');
  emailLabel.textContent = 'Email Address';
  emailLabel.setAttribute('for', 'welcomeEmail');
  const emailInput = document.createElement('input');
  emailInput.type = 'email';
  emailInput.id = 'welcomeEmail';
  emailInput.className = 'form-control';
  emailInput.required = true;
  emailGroup.appendChild(emailLabel);
  emailGroup.appendChild(emailInput);
  form.appendChild(emailGroup);
  
  // Phone field
  const phoneGroup = document.createElement('div');
  phoneGroup.className = 'form-group';
  const phoneLabel = document.createElement('label');
  phoneLabel.textContent = 'Phone Number';
  phoneLabel.setAttribute('for', 'welcomePhone');
  const phoneInput = document.createElement('input');
  phoneInput.type = 'tel';
  phoneInput.id = 'welcomePhone';
  phoneInput.className = 'form-control';
  phoneInput.placeholder = '(Optional)';
  phoneGroup.appendChild(phoneLabel);
  phoneGroup.appendChild(phoneInput);
  form.appendChild(phoneGroup);
  
  // Interest field
  const interestGroup = document.createElement('div');
  interestGroup.className = 'form-group';
  const interestLabel = document.createElement('label');
  interestLabel.textContent = 'Area of Interest';
  interestLabel.setAttribute('for', 'welcomeInterest');
  const interestSelect = document.createElement('select');
  interestSelect.id = 'welcomeInterest';
  interestSelect.className = 'form-control';
  interestSelect.required = true;
  const interests = [
    { value: '', text: 'Select an area of interest...' },
    { value: 'full-stack-python', text: 'Full Stack Python' },
    { value: 'full-stack-java', text: 'Full Stack Java' },
    { value: 'full-stack-mern', text: 'MERN Stack Development' },
    { value: 'digital-marketing', text: 'Digital Marketing' },
    { value: 'data-science-python', text: 'Data Science' },
    { value: 'mobile-app-android', text: 'Mobile App Development' },
    { value: 'selenium-testing', text: 'Software Testing' },
    { value: 'hr-course', text: 'HR Management' },
    { value: 'other', text: 'Other' }
  ];
  interests.forEach(interest => {
    const option = document.createElement('option');
    option.value = interest.value;
    option.textContent = interest.text;
    interestSelect.appendChild(option);
  });
  interestGroup.appendChild(interestLabel);
  interestGroup.appendChild(interestSelect);
  form.appendChild(interestGroup);
  
  // Submit button
  const submitBtn = document.createElement('button');
  submitBtn.type = 'submit';
  submitBtn.className = 'btn btn-primary';
  submitBtn.textContent = 'Get Started';
  submitBtn.style.marginTop = '15px';
  submitBtn.style.width = '100%';
  form.appendChild(submitBtn);
  
  formContainer.appendChild(title);
  formContainer.appendChild(description);
  formContainer.appendChild(form);
  chatBody.appendChild(formContainer);
  
  // Form submission
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const name = document.getElementById('welcomeName').value;
    const email = document.getElementById('welcomeEmail').value;
    const phone = document.getElementById('welcomePhone').value;
    const interest = document.getElementById('welcomeInterest').value;
    
    // Save form submission
    formSubmitted = true;
    localStorage.setItem(LS.formSubmitted, 'true');
    
    // Show tabs, quick replies, and input area after form submission
    tabsContainer.style.display = 'flex';
    quickReplies.style.display = 'flex';
    chatInputArea.style.display = 'flex';
    chatBody.classList.remove('no-tabs');
    
    // Clear form and show welcome message
    chatBody.innerHTML = '';
    
    // Include phone in welcome message if provided
    let welcomeMessage = `Thank you, ${name}! üëã Welcome to our Course Support.`;
    if (phone) {
      welcomeMessage += ` We've recorded your phone number: ${phone}.`;
    }
    welcomeMessage += ` How can I assist you today?`;
    
    botReply(welcomeMessage);
    
    // Enable all features
    document.getElementById('chatInput').disabled = false;
    document.getElementById('sendBtn').disabled = false;
    document.querySelectorAll('.quick-reply').forEach(reply => {
      reply.style.pointerEvents = 'auto';
      reply.style.opacity = '1';
    });
  });
  
  // Disable other features until form is submitted
  document.getElementById('chatInput').disabled = true;
  document.getElementById('sendBtn').disabled = true;
  document.querySelectorAll('.quick-reply').forEach(reply => {
    reply.style.pointerEvents = 'none';
    reply.style.opacity = '0.5';
  });
}
/* ========= Chat helpers ========= */
function addMessage(text, sender='bot', save=true, isoTime){
// Always show in chat tab
if (currentView !== 'chat') switchTab('chat');
const msgDiv = document.createElement('div');
msgDiv.className = `msg ${sender}`;
const bubble = document.createElement('div');
bubble.className = 'message-bubble';
bubble.innerHTML = (sender==='bot') ? text : escapeHTML(text);
const time = document.createElement('div');
time.className = 'message-time';
const t = isoTime ? new Date(isoTime) : new Date();
time.textContent = t.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
msgDiv.appendChild(bubble);
msgDiv.appendChild(time);
chatBody.appendChild(msgDiv);
chatBody.scrollTop = chatBody.scrollHeight;
if (save){
chatHistory.push({ text, sender, time: new Date().toISOString() });
localStorage.setItem(LS.history, JSON.stringify(chatHistory));
}
}
function botReply(text, sticker){
// typing indicator
const typ = document.createElement('div');
typ.className = 'msg bot';
const tBubble = document.createElement('div');
tBubble.className = 'typing';
tBubble.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
typ.appendChild(tBubble);
chatBody.appendChild(typ);
chatBody.scrollTop = chatBody.scrollHeight;
setTimeout(()=>{
typ.remove();
const msgDiv = document.createElement('div');
msgDiv.className = 'msg bot';
const bubble = document.createElement('div');
bubble.className = 'message-bubble';
bubble.innerHTML = text;
const time = document.createElement('div');
time.className = 'message-time';
time.textContent = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
msgDiv.appendChild(bubble);
if (sticker){
const img = document.createElement('img');
img.className = 'chat-sticker';
img.src = sticker;
img.alt = "";
msgDiv.appendChild(img);
}
msgDiv.appendChild(time);
chatBody.appendChild(msgDiv);
chatBody.scrollTop = chatBody.scrollHeight;
chatHistory.push({ text, sender:'bot', time: new Date().toISOString() });
localStorage.setItem(LS.history, JSON.stringify(chatHistory));
// Try to play sound with error handling
try {
  receiveSound.play().catch(e => console.warn('Could not play receive sound:', e));
} catch (e) {
  console.warn('Error playing receive sound:', e);
}
}, 850);
}
function sendMessage(){
  // Check if user has completed the enrollment form
  if (!formSubmitted) {
    // Show alert notification
    alert('Please enroll first before you can send a message.');
    
    // Also show bot reply for additional clarity
    botReply("Please complete the enrollment form first to chat with us.");
    return;
  }
  
  const text = chatInput.value.trim();
  if (!text) return;
  addMessage(text, 'user');
  chatInput.value = '';
  // Try to play sound with error handling
  try {
    sendSound.play().catch(e => console.warn('Could not play send sound:', e));
  } catch (e) {
    console.warn('Error playing send sound:', e);
  }
  handleUserMessage(text);
}
function handleUserMessage(text){
const lower = text.toLowerCase();
let response = "";
let sticker = "";
let showCourses = false;
let showDateTimePicker = false;

if (lower.includes('demo')) {
  response = "Great! I'd be happy to schedule a demo for you. Please select your preferred date and time:";
  showDateTimePicker = true;
} else if (lower.includes('enroll') || lower.includes('join') || lower.includes('register') || lower.includes('sign up')) {
response = "To enroll in one of our courses, please visit our website and complete the registration process. üìù You can also request a demo for any course by typing 'demo' in the chat. Our team will contact you within 24 hours to finalize your enrollment.";
} else if (lower.includes('course') || lower.includes('class') || lower.includes('program')) {
response = "We offer a wide range of courses including Full Stack Python, Full Stack Java, MERN Stack Development, Digital Marketing, Data Science, Mobile App Development, and more. üìö Would you like to see our course catalog?";
showCourses = true;
} else if (lower.includes('fee') || lower.includes('cost') || lower.includes('price') || lower.includes('payment')) {
response = "Course fees range from $99 to $499 depending on the course length and content. üí∞ We offer flexible payment plans and scholarships for eligible students. Do you need information about a specific course?";
} else if (lower.includes('schedule') || lower.includes('time') || lower.includes('duration')) {
response = "Most courses are instructor-led with durations ranging from 6 weeks to 20 weeks. üìÖ We also have ongoing programs like our Student Career Club. Some courses offer flexible scheduling for working professionals.";
} else if (lower.includes('certificate') || lower.includes('certification')) {
response = "Yes, we provide industry-recognized certificates of completion for all courses! üéì These certificates are valued by employers and can help you launch or advance your career.";
} else if (lower.includes('instructor') || lower.includes('teacher')) {
response = "Our instructors are industry professionals with extensive real-world experience in their fields. üë®‚Äçüè´ They include senior developers, digital marketing experts, data scientists, and HR professionals who provide personalized guidance.";
} else if (lower.includes('contact') || lower.includes('support') || lower.includes('help')) {
response = "Our support team is available 24/7 through this chat! üìû You can also email us at support@courses.com or call 1-800-COURSES during business hours.";
} else if (lower.includes('technical') || lower.includes('tech') || lower.includes('problem')) {
response = "For technical support, please describe your issue in detail. üíª Our technical team is ready to help resolve any platform or access issues you're experiencing.";
} else if (lower.includes('resource') || lower.includes('material')) {
response = "All courses include comprehensive learning materials including video lectures, reading materials, quizzes, assignments, projects, and additional resources. üîß We also provide career resources and placement assistance.";
} else if (lower.includes('hello') || lower.includes('hi')) {
response = "Hello! üëã Welcome to Course Support! How can I assist you with your learning journey today?";
sticker = "https://media.giphy.com/media/hvRJCLFzcasrR4ia7z/giphy.gif";
} else if (lower.includes('thank')) {
response = "You're welcome! üòä Is there anything else I can help with regarding our courses?";
} else if (lower.includes('form') || lower.includes('application')) {
response = "To get started with our courses, please complete the initial registration form. Once completed, you'll have full access to all our support features.";
} else if (lower.includes('catalog') || lower.includes('list') || lower.includes('available')) {
response = "I can show you our course catalog! üìö Just click on the 'Courses' tab inside the chat widget to browse all our available programs.";
showCourses = true;
} else {
response = "Thanks for your message! Our support team will get back to you shortly with information about our courses and enrollment process.";
}
const funEmojis = ["üìö", "üéì", "üë®‚Äçüéì", "üìù", "üîç", "üí°", "üöÄ", "üëç"];
response += " " + funEmojis[Math.floor(Math.random()*funEmojis.length)];
botReply(response, sticker);

if (showDateTimePicker) {
  setTimeout(() => {
    renderDateTimePicker();
  }, 1500);
}

if (showCourses) {
setTimeout(() => {
addMessage("I'll show you our course catalog now.", 'bot');
switchTab('courses');
}, 2000);
}
}
/* ========= File handling ========= */
function handleFiles(files) {
  if (files.length > 0) {
    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      // Check file size (limit to 10MB)
      if (file.size > 10 * 1024 * 1024) {
        botReply(`File "${file.name}" is too large. Please select files smaller than 10MB.`);
        continue;
      }
      attachedFiles.push(file);
      addFileToList(file);
    }
    
    // Notify user
    const fileNames = Array.from(files).filter(file => file.size <= 10 * 1024 * 1024).map(file => file.name).join(', ');
    if (fileNames) {
      addMessage(`Attached files: ${fileNames}`, 'user');
      botReply(`Thank you for attaching files. I've received your files and will review them.`);
    }
  }
}
function addFileToList(file) {
  const fileItem = document.createElement('div');
  fileItem.className = 'file-item';
  
  const fileName = document.createElement('div');
  fileName.className = 'file-name';
  fileName.textContent = file.name;
  
  const fileSize = document.createElement('div');
  fileSize.className = 'file-size';
  fileSize.textContent = formatFileSize(file.size);
  fileSize.style.fontSize = '11px';
  fileSize.style.color = 'var(--muted)';
  
  const fileRemove = document.createElement('div');
  fileRemove.className = 'file-remove';
  fileRemove.innerHTML = '<i class="fas fa-times"></i>';
  fileRemove.addEventListener('click', function() {
    const index = attachedFiles.indexOf(file);
    if (index > -1) {
      attachedFiles.splice(index, 1);
      fileItem.remove();
    }
  });
  
  const fileInfo = document.createElement('div');
  fileInfo.style.display = 'flex';
  fileInfo.style.flexDirection = 'column';
  fileInfo.style.flex = '1';
  fileInfo.appendChild(fileName);
  fileInfo.appendChild(fileSize);
  
  fileItem.appendChild(fileInfo);
  fileItem.appendChild(fileRemove);
  fileList.appendChild(fileItem);
}
function formatFileSize(bytes) {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}
/* ========= Courses Rendering ========= */
function renderCourses() {
  chatBody.innerHTML = '';
  const container = document.createElement('div');
  container.className = 'course-cards';
  const title = document.createElement('h3');
  title.textContent = 'Our Courses';
  title.style.marginTop = '0';
  title.style.marginBottom = '15px';
  title.style.color = 'var(--text)';
  title.style.textAlign = 'center';
  container.appendChild(title);
  courseData.forEach(course => {
    const card = document.createElement('div');
    card.className = 'course-card';
    
    const header = document.createElement('div');
    header.className = 'course-card-header';
    const titleEl = document.createElement('div');
    titleEl.className = 'course-title';
    titleEl.textContent = course.title;
    const duration = document.createElement('div');
    duration.className = 'course-duration';
    duration.textContent = course.duration;
    header.appendChild(titleEl);
    header.appendChild(duration);
    
    const description = document.createElement('div');
    description.className = 'course-description';
    description.textContent = course.description;
    
    const footer = document.createElement('div');
    footer.className = 'course-footer';
    
    const price = document.createElement('div');
    price.className = 'course-price';
    price.textContent = course.price;
    
    // Demo Button
    const demoBtn = document.createElement('button');
    demoBtn.className = 'demo-btn';
    demoBtn.innerHTML = '<i class="bi bi-calendar-event"></i> Request Demo';
    demoBtn.addEventListener('click', function() {
      currentDemoCourse = course.title;
      addMessage(`I would like to schedule a demo for ${course.title}`, 'user');
      botReply("Great! Please type 'demo' in the chat to schedule your demo session.");
    });
    
    footer.appendChild(price);
    footer.appendChild(demoBtn);
    
    card.appendChild(header);
    card.appendChild(description);
    card.appendChild(footer);
    container.appendChild(card);
  });
  chatBody.appendChild(container);
}
/* ========= FAQ Rendering ========= */
function renderFAQ(){
chatBody.innerHTML = '';
const wrap = document.createElement('div');
wrap.className = 'faq-wrap';
// Search bar
const search = document.createElement('div');
search.className = 'faq-search';
search.innerHTML = `<i class="bi bi-search"></i>
<input id="faqSearchInput" type="text" placeholder="Search FAQs...">`;
wrap.appendChild(search);
// Category blocks
faqData.forEach((cat, idx)=>{
const catEl = document.createElement('div');
catEl.className = 'faq-category';
catEl.innerHTML = `<div class="left"><span>${cat.category}</span></div>
<small><i class="bi bi-caret-down"></i></small>`;
wrap.appendChild(catEl);
const acc = document.createElement('div');
acc.className = 'faq-accordion';
cat.questions.forEach(item=>{
const q = document.createElement('div');
q.className = 'faq-question';
q.textContent = item.q;
q.addEventListener('click', ()=>{
addMessage(item.q, 'user');
botReply(item.a);
});
acc.appendChild(q);
});
wrap.appendChild(acc);
catEl.addEventListener('click', ()=>{
const opened = acc.classList.toggle('open');
catEl.querySelector('small').innerHTML = opened
? `<i class="bi bi-caret-up"></i>`
: `<i class="bi bi-caret-down"></i>`;
});
});
chatBody.appendChild(wrap);
// Search filter
const input = wrap.querySelector('#faqSearchInput');
input.addEventListener('input', ()=>{
const term = input.value.trim().toLowerCase();
const blocks = wrap.querySelectorAll('.faq-category');
const accordions = wrap.querySelectorAll('.faq-accordion');
faqData.forEach((cat, i)=>{
const showCat = cat.category.toLowerCase().includes(term) ||
cat.questions.some(q=> q.q.toLowerCase().includes(term));
blocks[i].style.display = showCat ? '' : 'none';
accordions[i].classList.toggle('open', term && showCat); // auto-open when search
});
});
}
/* ========= Modern Date/Time Picker ========= */
function renderDateTimePicker() {
  const pickerHTML = `
    <div class="datetime-picker-modern">
      <h5>Schedule Your Demo</h5>
      <div class="datetime-row">
        <div class="datetime-input-group">
          <div class="datetime-input-label">
            <i class="bi bi-calendar3"></i> Date
          </div>
          <input type="date" id="demo-date" class="datetime-input-field" min="${new Date().toISOString().split('T')[0]}">
        </div>
        <div class="datetime-input-group">
          <div class="datetime-input-label">
            <i class="bi bi-clock"></i> Time
          </div>
          <input type="time" id="demo-time" class="datetime-input-field">
        </div>
      </div>
      <button class="datetime-schedule-btn" id="schedule-demo-btn">Schedule Demo</button>
    </div>
  `;
  
  // Add the picker as a bot message
  const msgDiv = document.createElement('div');
  msgDiv.className = 'msg bot';
  const bubble = document.createElement('div');
  bubble.className = 'message-bubble';
  bubble.innerHTML = pickerHTML;
  const time = document.createElement('div');
  time.className = 'message-time';
  time.textContent = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  msgDiv.appendChild(bubble);
  msgDiv.appendChild(time);
  chatBody.appendChild(msgDiv);
  chatBody.scrollTop = chatBody.scrollHeight;
  
  // Add event listeners after the picker is rendered
  setTimeout(() => {
    const scheduleBtn = document.getElementById('schedule-demo-btn');
    const dateInput = document.getElementById('demo-date');
    const timeInput = document.getElementById('demo-time');
    
    scheduleBtn.addEventListener('click', function() {
      if (dateInput.value && timeInput.value) {
        const selectedDateTime = new Date(`${dateInput.value}T${timeInput.value}`);
        const formattedDateTime = selectedDateTime.toLocaleString();
        
        let courseName = "a course";
        if (currentDemoCourse) {
          courseName = currentDemoCourse;
          currentDemoCourse = null; // Reset after use
        }
        
        addMessage(`Demo scheduled for ${courseName} on ${formattedDateTime}`, 'user');
        botReply(`Perfect! Your demo for ${courseName} has been scheduled for ${formattedDateTime}. Our team will send you a confirmation shortly. Is there anything else you'd like to know?`);
      } else {
        botReply("Please select both date and time to schedule your demo.");
      }
    });
  }, 100);
}
/* ========= Utilities ========= */
function clearChatSafe(){
  if (!confirm('Clear conversation? This will reset the chat and show the welcome form again.')) return;
  
  // Reset form submission state
  formSubmitted = false;
  localStorage.setItem(LS.formSubmitted, 'false');
  
  // Clear chat history
  chatHistory = [];
  localStorage.setItem(LS.history, JSON.stringify(chatHistory));
  
  // Reset session to show form again
  localStorage.setItem(LS.sessionStart, Date.now().toString());
  
  // Switch to chat tab and show welcome form
  currentView = 'chat';
  localStorage.setItem(LS.view, 'chat');
  tabButtons.forEach(b => b.classList.toggle('active', b.dataset.tab === 'chat'));
  
  // Hide tabs, quick replies, and input area again
  tabsContainer.style.display = 'none';
  quickReplies.style.display = 'none';
  chatInputArea.style.display = 'none';
  chatBody.classList.add('no-tabs');
  
  // Show the welcome form again
  renderWelcomeForm();
}
function toggleTheme(){
const now = chatWidget.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
chatWidget.setAttribute('data-theme', now);
localStorage.setItem(LS.theme, now);
themeToggleBtn.innerHTML = now === 'dark' ? '<i class="bi bi-brightness-high"></i>' : '<i class="bi bi-moon-stars"></i>';
}
function escapeHTML(s){
return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
/* ========= Start ========= */
initChat();
</script>
</body>
</html>